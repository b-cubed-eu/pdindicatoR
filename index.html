<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculate and visualize a phylogenetic diversity indicators based on species occurrence data cubes • pdindicatoR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/PT_Sans-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Calculate and visualize a phylogenetic diversity indicators based on species occurrence data cubes">
<meta name="description" content="A package to calculate and produce a map of phylogenetic diversity scores for each grid cell in the input species occurrences data cube, and calculate the percentage of high PD cells within currently protected areas. You provide a phylogenetic tree, the datacube for the corresponding species is downloaded from GBIF (or user-uploaded), and the package does the rest.">
<meta property="og:description" content="A package to calculate and produce a map of phylogenetic diversity scores for each grid cell in the input species occurrences data cube, and calculate the percentage of high PD cells within currently protected areas. You provide a phylogenetic tree, the datacube for the corresponding species is downloaded from GBIF (or user-uploaded), and the package does the rest.">
<meta property="og:image" content="https://b-cubed-eu.github.io/pdindicatoR/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">pdindicatoR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://b-cubed.eu/" aria-label="B-Cubed website"><span class="fa fa-cube"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/b-cubed-eu/pdindicatoR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="pdindicator-">pdindicatoR <a class="anchor" aria-label="anchor" href="#pdindicator-"></a>
</h1>
</div>
<!-- badges: start -->

<!-- badges: end -->
<p>Phylogenetic diversity (PD) is a measure of biodiversity which takes evolution into account. It is calculated as the sum of the lengths of the phylogenetic tree branches representing the minimum tree-spanning path among a group of species. Phylogenetic diversity can be used in conservation planning to maximise a variety of features, meaning we do not aim to conserve specific features, but rather want to boost a diverse range of features. Conserving a variety of features could be particularly useful in light of the changing environmental conditions, as we can only guess which features will be important in the future.</p>
<p>In this package, we provide a workflow to calculate a metric that gives information about how well PD of a certain higher taxonomic group is currently safeguarded by protected areas and a spatial visualisation which can be used to identify potential directions for future expansion of protected areas.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install <strong>pdindicatoR</strong> in R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pdindicatoR"</span>, repos <span class="op">=</span> <span class="st">"https://b-cubed-eu.r-universe.dev"</span><span class="op">)</span></span></code></pre></div>
<p>You can install the development version from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"b-cubed-eu/pdindicatoR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-workflow">Example workflow<a class="anchor" aria-label="anchor" href="#example-workflow"></a>
</h2>
<p>This example shows a basic workflow for using the functions in the <strong>pdindicatoR</strong> package to calculate PD from a phylogenetic tree and an occurrence cube with occurrences for a certain higher taxon, produce a gridded map of PD scores with colour gradient scale, and show the overlap with protected areas.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/b-cubed-eu/pdindicatoR" class="external-link">pdindicatoR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>      <span class="co"># working with spatial objects</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>   <span class="co"># data wrangling</span></span></code></pre></div>
<div class="section level3">
<h3 id="reading-in-data">Reading in data<a class="anchor" aria-label="anchor" href="#reading-in-data"></a>
</h3>
<p>In order to start the workflow, the user should specify the filepaths to a phylogenetic tree, a species data occurrence cube, and two shapefiles:<br>
1) a grid, which should correspond to the grid used to generate the datacube<br>
2) a polygon shapefile with boundaries of protected areas.</p>
<p>The phylogenetic tree should be in either nexus or newick format. The species occurrence cube must have the same variable names as the example datacube (or the columns should be renamed after loading). For more information on how to obtain species occurrence cubes from GBIF and phylogenetic trees to be used with this package, we refer to the vignette ‘Finding datasets to use with pdindicatoR’.</p>
<p>The following functions can be used to read in datafiles:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_path</span> <span class="op">&lt;-</span> <span class="st">"/path/to/mytree.tre"</span> </span>
<span><span class="va">cube_path</span> <span class="op">&lt;-</span> <span class="st">"/path/to/mycube.csv"</span></span>
<span><span class="va">grid_path</span> <span class="op">&lt;-</span> <span class="st">"/path/to/grid.shp"</span></span>
<span></span>
<span><span class="co"># Read in newick or nexus format phylogenetic tree</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tree_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read in species occurrence data cube. Use appropriate seperator!</span></span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">cube_path</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Read in grid and protected areas shapefile</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">grid_filepath</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-example-data">Loading example data<a class="anchor" aria-label="anchor" href="#loading-example-data"></a>
</h3>
<p>For this example workflow, we will be using the example data that is included in the <strong>pdindicatoR</strong> package. The example data can be loaded by using the function <code><a href="reference/retrieve_example_data.html">retrieve_example_data()</a></code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/retrieve_example_data.html">retrieve_example_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">ex_data</span><span class="op">$</span><span class="va">tree</span> </span>
<span><span class="va">cube</span> <span class="op">&lt;-</span> <span class="va">ex_data</span><span class="op">$</span><span class="va">cube</span> </span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">ex_data</span><span class="op">$</span><span class="va">grid</span></span>
<span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="va">ex_data</span><span class="op">$</span><span class="va">pa</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspect-tree-and-cube">Inspect tree and cube<a class="anchor" aria-label="anchor" href="#inspect-tree-and-cube"></a>
</h3>
<p>We plot the tree and print the first lines of the occurrence cube to confirm they are processed correctly.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, cex <span class="op">=</span> <span class="fl">0.35</span>, y.lim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-2-1.png" alt="Phylogenetic tree"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cube</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">##   year   eeacellcode specieskey           species establishmentmeans degreeofestablishment pathway occurrences distinctobservers</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## 1 2024 1kmE3996N3087    2880539     Quercus rubra                                       NA      NA           1                 1</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="do">## 2 2024 1kmE3997N3088    3054357     Juglans nigra                                       NA      NA           2                 1</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## 3 2024 1kmE3997N3090    3054368     Juglans regia                                       NA      NA           1                 1</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="do">## 4 2024 1kmE3997N3100    2880539     Quercus rubra                                       NA      NA           1                 1</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="do">## 5 2024 1kmE3997N3104    5333294   Castanea sativa                                       NA      NA           1                 1</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="do">## 6 2024 1kmE3997N3104    8313153 Quercus palustris                                       NA      NA           1                 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matching-species-in-phylogenetic-tree-and-datacube">Matching species in phylogenetic tree and datacube<a class="anchor" aria-label="anchor" href="#matching-species-in-phylogenetic-tree-and-datacube"></a>
</h3>
<p>The leaf labels of a phylogenetic tree downloaded from the OTL database are specified as either species names or OTL id’s (<code>ott_id</code>). We can use the function <code><a href="reference/taxonmatch.html">taxonmatch()</a></code> to retrieve the corresponding GBIF id’s.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/taxonmatch.html">taxonmatch</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">##               search_string               unique_name approximate_match score  ott_id is_synonym  flags number_matches gbif_id             orig_tiplabel</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="do">## 1     alfaroa costaricensis     Alfaroa costaricensis             FALSE     1  199041      FALSE                     1 7310550     Alfaroa costaricensis</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">## 2    alfaroa guanacastensis    Alfaroa guanacastensis             FALSE     1  199043      FALSE                     2      NA    Alfaroa guanacastensis</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="do">## 3         alfaroa manningii         Alfaroa manningii             FALSE     1  199049      FALSE                     1 4205554         Alfaroa manningii</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">## 4        alfaroa williamsii        Alfaroa williamsii             FALSE     1 1064109      FALSE                     1 7310534        Alfaroa williamsii</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="do">## 5                alfaropsis                Alfaropsis             FALSE     1  200433      FALSE barren              2      NA                Alfaropsis</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="do">## 6 allocasuarina acutivalvis Allocasuarina acutivalvis             FALSE     1  769753      FALSE                     1 2891875 Allocasuarina acutivalvis</span></span></code></pre></div>
<p>Carefully evaluate the table with matches to ensure that matching scores are acceptable and that most species have a corresponding <code>gbif_id</code>. Species that cannot be reliable matched or that don’t have an associated <code>gbif_id</code>, can not contribute to the PD calculation and should be removed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matched_nona</span> <span class="op">&lt;-</span> <span class="va">matched</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">gbif_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can use the function <code><a href="reference/append_ott_id.html">append_ott_id()</a></code> to append the <code>ott_id</code>’s as a new variable to the provided datacube, by joining on <code>gbif_id</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcube</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/append_ott_id.html">append_ott_id</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">cube</span>, <span class="va">matched_nona</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mcube</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">##   year   eeacellcode specieskey           species establishmentmeans degreeofestablishment pathway occurrences distinctobservers  ott_id       unique_name     orig_tiplabel</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="do">## 1 2024 1kmE3996N3087    2880539     Quercus rubra                                       NA      NA           1                 1  791115     Quercus rubra     Quercus rubra</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">## 2 2024 1kmE3997N3088    3054357     Juglans nigra                                       NA      NA           2                 1 1072887     Juglans nigra     Juglans nigra</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="do">## 3 2024 1kmE3997N3090    3054368     Juglans regia                                       NA      NA           1                 1  138717     Juglans regia     Juglans regia</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="do">## 4 2024 1kmE3997N3100    2880539     Quercus rubra                                       NA      NA           1                 1  791115     Quercus rubra     Quercus rubra</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="do">## 5 2024 1kmE3997N3104    5333294   Castanea sativa                                       NA      NA           1                 1 1028994   Castanea sativa   Castanea sativa</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="do">## 6 2024 1kmE3997N3104    8313153 Quercus palustris                                       NA      NA           1                 1  538292 Quercus palustris Quercus palustris</span></span></code></pre></div>
<p>When species in the datacube are not included in the provided phylogenetic tree, the <code>ott_id</code> variable will be <code>NA</code>. We can use the function check_completeness() to see how complete the provided phylogenetic tree is.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/check_completeness.html">check_completeness</a></span><span class="op">(</span><span class="va">mcube</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## The following species are not part of the provided phylogenetic tree:</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="do">##    specieskey                 species</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="do">## 1     9148577            Alnus incana</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="do">## 2          NA                        </span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="do">## 3     2880130         Quercus petraea</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="do">## 4     2880580          Quercus cerris</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="do">## 5     8288647 Pterocarya fraxinifolia</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="do">## 6     2879292         Quercus rosacea</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="do">## 7     2879520        Quercus conferta</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="do">## 8     2876571         Alnus pubescens</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="do">## 9     7797155           Alnus hirsuta</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="do">## 10    2880652         Quercus phellos</span></span></code></pre></div>
<p>Please note that occurrence records for species that are not part of the provided phylogenetic tree will need to be removed. In case this number is large, please consider searching for a more complete phylogenetic tree that covers all your species!</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcube</span> <span class="op">&lt;-</span> <span class="va">mcube</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ott_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-phylogenetic-diversity-for-each-grid-cell">Calculate Phylogenetic Diversity for each grid cell<a class="anchor" aria-label="anchor" href="#calculate-phylogenetic-diversity-for-each-grid-cell"></a>
</h3>
<p>We can used the function get_pd_cube() to calculate the PD values per gridcell. This function first creates a new aggregated cube, with a list of observed species for each grid cell. The optional argument <code>timegroup</code> can be used to indicate a time interval for which the PD metrics should be calculated, e.g. <code>timegroup = 5</code> calculates PD for all occurrences observed within a timespan of 5 years and produces a separate map and indicator for each period. If no <code>timegroup</code> argument is specified, all occurrences in the dataset will be aggregated over time. The argument <code>metric</code> can be used to specify which PD metric needs to be calculated. The PD values will be appended to the datacube as a new column ‘PD’.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_pd_cube.html">get_pd_cube</a></span><span class="op">(</span><span class="va">mcube</span>, <span class="va">tree</span>, metric <span class="op">=</span> <span class="st">"faith"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-pd-on-a-map--calculate-indicator">Visualize PD on a map &amp; calculate indicator<a class="anchor" aria-label="anchor" href="#visualize-pd-on-a-map--calculate-indicator"></a>
</h3>
<p>Finally we read in the EEA Grid shapefiles and merge them to the occurrence cube by joining on the <code>eeaCellCode</code> field. The PD cube can then be plotted and overlaid with a polygon layer depicting the boundaries of WDPA protected areas.</p>
<div class="section level4">
<h4 id="plot-pd-map">Plot PD map<a class="anchor" aria-label="anchor" href="#plot-pd-map"></a>
</h4>
<p>The function generate_map_and_indicator() can be used to generate a map visualizing phylogenetic diversity covering the geographic area that is used to generate the occurrence cube.If more detailed maps are desired, the optional argument <code>bbox_custom</code> can be used to delineate the bounding box. Coordinates for the desired geographic area can be determined using <a href="https://epsg.io/" class="external-link uri">https://epsg.io/</a> and selecting the CRS of the used grid.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdindicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generate_map_and_indicator.html">generate_map_and_indicator</a></span><span class="op">(</span><span class="va">pd_cube</span>, <span class="va">grid</span>, <span class="st">"Fagales"</span><span class="op">)</span></span>
<span><span class="va">pdindicator</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-9-1.png" alt="PD map"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optionally specify a custom bounding box</span></span>
<span><span class="co"># bbox_custom &lt;- c(xmin,xmax,ymin,ymax)</span></span>
<span><span class="co"># pdmap &lt;- generate_map_and_indicator(pd_cube, grid, "Musteloidea", bbox_custom)</span></span></code></pre></div>
<p>If the optional parameter <code>cutoff</code> is specified, than this value is used to classify cells as <em>high PD</em> cells if their PD exceeds this threshold value. An indicator value is then calculated as the percentage of high PD cell centerpoints that fall within the boundaries of protected areas. The result is stored as a list, with two maps in the first element (PD map and high/low PD map) and the indicator value as the second element.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdindicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/generate_map_and_indicator.html">generate_map_and_indicator</a></span><span class="op">(</span></span>
<span>  <span class="va">pd_cube</span>,</span>
<span>  <span class="va">grid</span>,</span>
<span>  <span class="st">"Fagales"</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">450</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="va">pdindicator</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">indicators</span> <span class="op">&lt;-</span> <span class="va">pdindicator</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="do">## [[1]]</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="do">## [[2]]</span></span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-11-2.png"><!-- --></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"The percentage of high PD grid cells that fall within"</span>,</span>
<span>                <span class="st">"protected areas is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">indicators</span><span class="op">$</span><span class="va">Overall</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="do">## [1] "The percentage of high PD grid cells that fall within protected areas is 23.46 %"</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/b-cubed-eu/pdindicatoR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/b-cubed-eu/pdindicatoR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing pdindicatoR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Lissa Breugelmans <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-8472-3577" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Maarten Trekels <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-8282-8765" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Louise Hendrickx <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9317-7862" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>European Union's Horizon Europe Research and Innovation Programme (ID No 101059592) <br><small class="roles"> Funder </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#wip" class="external-link"><img src="https://www.repostatus.org/badges/latest/wip.svg" alt="repo status"></a></li>
<li><a href="https://github.com/b-cubed-eu/pdindicatoR/releases" class="external-link"><img src="https://img.shields.io/github/release/b-cubed-eu/pdindicatoR.svg" alt="Release"></a></li>
<li><a href="https://b-cubed-eu.r-universe.dev/pdindicatoR" class="external-link"><img src="https://b-cubed-eu.r-universe.dev/pdindicatoR/badges/version" alt="pdindicatoR status badge"></a></li>
<li><a href="https://CRAN.R-project.org/package=pdindicatoR" class="external-link"><img src="https://www.r-pkg.org/badges/version/pdindicatoR" alt="CRAN status"></a></li>
<li><a href="https://github.com/b-cubed-eu/pdindicatoR/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/b-cubed-eu/pdindicatoR/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/b-cubed-eu/pdindicatoR" class="external-link"><img src="https://codecov.io/gh/b-cubed-eu/pdindicatoR/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://doi.org/10.5281/zenodo.14237551" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.14237551.svg" alt="DOI"></a></li>
<li><a href="https://b-cubed-eu.r-universe.dev/" class="external-link"><img src="https://b-cubed-eu.r-universe.dev/badges/:name?color=6CDDB4" alt="name status badge"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lissa Breugelmans, Maarten Trekels, Louise Hendrickx, European Union’s Horizon Europe Research and Innovation Programme (ID No 101059592).</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
